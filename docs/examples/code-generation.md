# Code Generation Examples

Generate source code from templates and data schemas.

## Go Struct Generation

### Template

`model.go.tmpl`:
```go
// Code generated by render. DO NOT EDIT.
package {{ .package }}

import (
{{- range .imports }}
	"{{ . }}"
{{- end }}
)

// {{ .name }} represents {{ .description | default "a data model" }}.
type {{ .name }} struct {
{{- range .fields }}
	{{ .name | pascalCase }} {{ .type }}{{ if .json }} `json:"{{ .name | snakeCase }}{{ if .omitempty }},omitempty{{ end }}"`{{ end }}{{ if .comment }} // {{ .comment }}{{ end }}
{{- end }}
}

// New{{ .name }} creates a new {{ .name }} with default values.
func New{{ .name }}() *{{ .name }} {
	return &{{ .name }}{
{{- range .fields }}
{{- if .default }}
		{{ .name | pascalCase }}: {{ .default }},
{{- end }}
{{- end }}
	}
}

{{- if .validation }}

// Validate checks if the {{ .name }} is valid.
func (m *{{ .name }}) Validate() error {
{{- range .fields }}
{{- if .required }}
	if m.{{ .name | pascalCase }} == {{ .zeroValue | default (printf "%q" "") }} {
		return fmt.Errorf("{{ .name | snakeCase }} is required")
	}
{{- end }}
{{- end }}
	return nil
}
{{- end }}
```

### Data

`user-model.yaml`:
```yaml
package: models
name: User
description: a user in the system
validation: true
imports:
  - fmt
  - time
fields:
  - name: id
    type: string
    json: true
    required: true
    zeroValue: '""'
  - name: email
    type: string
    json: true
    required: true
    zeroValue: '""'
  - name: name
    type: string
    json: true
    omitempty: true
  - name: createdAt
    type: time.Time
    json: true
    default: time.Now()
    comment: When the user was created
  - name: active
    type: bool
    json: true
    default: "true"
```

### Command

```bash
render model.go.tmpl user-model.yaml -o models/user.go
```

### Output

`models/user.go`:
```go
// Code generated by render. DO NOT EDIT.
package models

import (
	"fmt"
	"time"
)

// User represents a user in the system.
type User struct {
	Id        string    `json:"id"`
	Email     string    `json:"email"`
	Name      string    `json:"name,omitempty"`
	CreatedAt time.Time `json:"created_at"` // When the user was created
	Active    bool      `json:"active"`
}

// NewUser creates a new User with default values.
func NewUser() *User {
	return &User{
		CreatedAt: time.Now(),
		Active:    true,
	}
}

// Validate checks if the User is valid.
func (m *User) Validate() error {
	if m.Id == "" {
		return fmt.Errorf("id is required")
	}
	if m.Email == "" {
		return fmt.Errorf("email is required")
	}
	return nil
}
```

## Multiple Models from Schema

Generate multiple model files from a single schema.

### Template

`entity.go.tmpl`:
```go
package {{ .package }}

type {{ .name | pascalCase }} struct {
{{- range .fields }}
	{{ .name | pascalCase }} {{ .type }} `json:"{{ .name | snakeCase }}"`
{{- end }}
}
```

### Data

`schema.yaml`:
```yaml
package: domain
entities:
  - name: product
    fields:
      - name: id
        type: string
      - name: name
        type: string
      - name: price
        type: float64

  - name: order
    fields:
      - name: id
        type: string
      - name: productId
        type: string
      - name: quantity
        type: int
      - name: total
        type: float64

  - name: customer
    fields:
      - name: id
        type: string
      - name: email
        type: string
      - name: name
        type: string
```

### Command

```bash
render entity.go.tmpl schema.yaml \
  --query '. as $root | .entities[] | . + {package: $root.package}' \
  --item-query '.' \
  -o 'domain/{{ .name | snakeCase }}.go'
```

### Output

Creates three files:
- `domain/product.go`
- `domain/order.go`
- `domain/customer.go`

## TypeScript Interface Generation

### Template

`interface.ts.tmpl`:
```typescript
// Generated by render - do not edit

{{- range .imports }}
import { {{ .types | join ", " }} } from '{{ .from }}';
{{- end }}

/**
 * {{ .description | default .name }}
 */
export interface {{ .name }} {
{{- range .fields }}
  /**
   * {{ .description | default .name }}
   */
  {{ .name }}{{ if .optional }}?{{ end }}: {{ .type }};
{{- end }}
}

{{- if .factory }}

export function create{{ .name }}(partial: Partial<{{ .name }}> = {}): {{ .name }} {
  return {
{{- range .fields }}
    {{ .name }}: partial.{{ .name }} {{ if .default }}?? {{ .default }}{{ else }}!{{ end }},
{{- end }}
  };
}
{{- end }}
```

### Data

`api-types.yaml`:
```yaml
types:
  - name: ApiResponse
    description: Standard API response wrapper
    factory: true
    fields:
      - name: success
        type: boolean
        default: "true"
      - name: data
        type: T | null
        optional: true
      - name: error
        type: string | null
        optional: true
      - name: timestamp
        type: Date
        default: new Date()

  - name: User
    description: User account information
    factory: true
    imports:
      - from: "./types"
        types:
          - Role
    fields:
      - name: id
        type: string
      - name: email
        type: string
      - name: name
        type: string
        optional: true
      - name: role
        type: Role
        default: "'user'"
      - name: createdAt
        type: Date
```

### Command

```bash
render interface.ts.tmpl api-types.yaml \
  --item-query '.types[]' \
  -o 'src/types/{{ .name | kebabCase }}.ts'
```

## SQL Migration Generation

### Template

`migration.sql.tmpl`:
```sql
-- Migration: Create {{ .table }} table

CREATE TABLE {{ .table }} (
{{- range $i, $col := .columns }}
    {{ $col.name }} {{ $col.type }}{{ if $col.primary }} PRIMARY KEY{{ end }}{{ if $col.notNull }} NOT NULL{{ end }}{{ if $col.unique }} UNIQUE{{ end }}{{ if $col.default }} DEFAULT {{ $col.default }}{{ end }}{{ if lt $i (sub (len $.columns) 1) }},{{ end }}
{{- end }}
);

{{- range .indexes }}

CREATE {{ if .unique }}UNIQUE {{ end }}INDEX {{ .name }} ON {{ $.table }} ({{ .columns | join ", " }});
{{- end }}

{{- if .foreignKeys }}
{{ range .foreignKeys }}
ALTER TABLE {{ $.table }}
    ADD CONSTRAINT fk_{{ $.table }}_{{ .column }}
    FOREIGN KEY ({{ .column }})
    REFERENCES {{ .references.table }} ({{ .references.column }})
    ON DELETE {{ .onDelete | default "RESTRICT" }};
{{- end }}
{{- end }}
```

### Data

`users-table.yaml`:
```yaml
table: users
columns:
  - name: id
    type: UUID
    primary: true
    default: gen_random_uuid()
  - name: email
    type: VARCHAR(255)
    notNull: true
    unique: true
  - name: name
    type: VARCHAR(100)
    notNull: true
  - name: password_hash
    type: VARCHAR(255)
    notNull: true
  - name: role_id
    type: UUID
    notNull: true
  - name: created_at
    type: TIMESTAMP
    notNull: true
    default: NOW()
  - name: updated_at
    type: TIMESTAMP
    notNull: true
    default: NOW()

indexes:
  - name: idx_users_email
    columns:
      - email
    unique: true
  - name: idx_users_role
    columns:
      - role_id

foreignKeys:
  - column: role_id
    references:
      table: roles
      column: id
    onDelete: RESTRICT
```

### Command

```bash
render migration.sql.tmpl users-table.yaml -o migrations/001_create_users.sql
```

## Project Scaffolding

Generate an entire project structure.

### Template Directory

```
project-template/
  .render.yaml
  cmd/
    {{appName}}/
      main.go.tmpl
  internal/
    {{appName}}/
      handler.go.tmpl
      service.go.tmpl
  go.mod.tmpl
  Makefile.tmpl
  README.md.tmpl
```

### Control File

`.render.yaml`:
```yaml
paths:
  "cmd/{{appName}}": "cmd/{{ .appName }}"
  "internal/{{appName}}": "internal/{{ .appName }}"
```

### Data

`new-project.yaml`:
```yaml
appName: myservice
module: github.com/example/myservice
description: A microservice for handling user data
goVersion: "1.21"
author: Jane Developer
```

### Command

```bash
render ./project-template new-project.yaml -o ./myservice
```

### Result

```
myservice/
  cmd/
    myservice/
      main.go
  internal/
    myservice/
      handler.go
      service.go
  go.mod
  Makefile
  README.md
```
